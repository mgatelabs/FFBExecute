//@formatter:off
{
  "vars": [
    {
      "name": "allow-expedition",
      "display": "Expedition",
      "value": "1",
      "type": "INT",
      "modify": "EDITABLE",
      "displayType": "BOOLEAN",
      "order": 10,
      "tierId": "enable",
      "values": [
        {"name": "Enabled", "value": "1"},
        {"name": "Disabled", "value": "0"}
      ],
      "description": "Enable / Disable ARENA"
    }
  ],
  "states":{

    // Inject our code into the router
    "_any_router_to_expedition": {
      "name": "Any - Home Can Goto Expedition?",
      "variables": {
        "toState": {
          "value": "EXPEDITION",
          "type": "STRING"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "menu-home",
            "and": [
              {
                "is": "EQUAL",
                "value": "EXPEDITION",
                "var": "toState"
              }
            ]
          },
          "actions": [
            {
              "type": "SET",
              "var": "setup",
              "value": "0"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "_screen_saver"
            },
            {
              "type": "MOVE",
              "value": "home_to_expedition",
              "condition": {
                "is": "EQUAL",
                "value": "1",
                "var": "allow-expedition"
              }
            },
            {
              "type": "SET",
              "value": "EXTRA",
              "var": "toState"
            },
            {
              "type": "REPEAT"
            }
          ]
        }
      ]
    },

    // Logic to move to expedition screen
    "home_to_expedition": {
      "name": "Home - To Expedition",
      "includes": [
        "_home_daily_fixes",
        "_common-no_op"
      ],
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "menu-home"
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Going to Expedition"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "TAP",
              "value": "menu-home-expedition"
            },
            {
              "type": "WAIT",
              "value": "3000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "SCREEN",
            "value": "menu-expedition-ongoing",
            "or": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-new"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Found Expedition Screen"
            },
            {
              "type": "MOVE",
              "value": "expedition"
            }
          ]
        }
      ]
    },

    // Actual expedtion logic
    "expedition": {
      "name": "Expeditions",
      "includes": [
        "_expedition-start",
        "_expedition-ongoing",
        "_expedition-new",
        "_common-no_op"
      ]
    },

    "_expedition-start": {
      "name": "Expeditions - Startup",
      "includes": [],
      "variables": {
        "segment": {
          "type": "INT",
          "value": "0"
        }
      },
      "statements": [
        // If we started on the new screen, switch to Ongoing
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "0",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-new"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Found Expedition - New Screen, switching to Ongoing"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-ongoing"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT"
            }
          ]
        },
        // If we're on Ongoing, switch to next segment
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "0",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Found Expedition - Ongoing Screen, trying to receive"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        }
      ]
    },

    "_expedition-ongoing": {
      "name": "Expeditions - Ongoing",
      "includes": [],
      "variables": {
        "receiving": {
          "type": "INT",
          "value": "0"
        }
      },
      "statements": [
        // Last item is complete, tap it
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-3"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-3-complete"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Receiving Expedition Reward #3"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-3"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "SET",
              "var": "receiving",
              "value": "1"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-3"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-2"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-2-complete"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Receiving Expedition Reward #2"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-2"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "SET",
              "var": "receiving",
              "value": "1"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-2"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-1"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-1-complete"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Receiving Expedition Reward #1"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-1"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "SET",
              "var": "receiving",
              "value": "1"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-1"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-0"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-0-complete"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Receiving Expedition Reward #0"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-0"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "SET",
              "var": "receiving",
              "value": "1"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-item-0"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "andOr": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-results-next"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-results-units"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Expedition Results"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-results-next"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "SET",
              "var": "receiving",
              "value": "0"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "EQUAL",
                "var": "receiving",
                "value": "1"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Receiving"
            },
            {
              "type": "TAP",
              "value": "screen-center-small"
            },
            {
              "type": "WAIT",
              "value": "1000"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              }
            ],
            "andOr": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-0"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-1"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-2"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-item-3"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Expeditions are full, leaving"
            },
            {"type": "MOVE", "value": "any_to_home", "args": {"toState": "EXTRA"}}
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              }
            ],
            "andOr": [
              {
                "not": "SCREEN",
                "value": "menu-expedition-item-0"
              },
              {
                "not": "SCREEN",
                "value": "menu-expedition-item-1"
              },
              {
                "not": "SCREEN",
                "value": "menu-expedition-item-2"
              },
              {
                "not": "SCREEN",
                "value": "menu-expedition-item-3"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Expeditions are not full, switching to New"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-new"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "1",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-new"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Looking for new expeditions"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "2"
            },
            {
              "type": "REPEAT"
            }
          ]
        }
      ]
    },

    "_expedition-new": {
      "name": "Expeditions - New",
      "includes": [],
      "variables": {
        //"receiving": {
        //  "type": "INT",
        //  "value": "0"
        //}
      },
      "statements": [
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "2",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-new"
              },
              {
                "is": "SCREEN",
                "value": "menu-expedition-new-0-super"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Tapping Supersite Expedition"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-new-0"
            },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "2",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-new"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Out of Supercites, returning"
            },
            {"type": "MOVE", "value": "any_to_home", "args": {"toState": "EXTRA"}}
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "2",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-ongoing"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Expeditions full, returning"
            },
            {"type": "MOVE", "value": "any_to_home", "args": {"toState": "EXTRA"}}
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "2",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-depart"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Starting Supersite Expedition"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-auto_fill"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-depart"
            },
            {
              "type": "REPEAT"
            }
          ]
        },
        {
          "condition": {
            "is": "EQUAL",
            "var": "segment",
            "value": "2",
            "and": [
              {
                "is": "SCREEN",
                "value": "menu-expedition-confirm"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Daparting Supersite Expedition"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-confirm-item"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "TAP",
              "value": "menu-expedition-confirm-depart"
            },
            {
              "type": "REPEAT"
            }
          ]
        }
      ]
    }

  }
}