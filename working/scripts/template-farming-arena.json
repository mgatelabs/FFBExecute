{
  "vars": [],
  "imports": [],
  "states": {

    "arena-battle-fight": {
      "name": "Arena - Battle - Fight (Override)",
      "description":"Continue fighting if every unit is fine, otherwise return to setup step.",
      "includes": [
        "_arena-battle-fight",
        "_common-no_op"
      ],
      "variables": {
        "segment": {
          "value": "0",
          "type": "INT"
        },
        "turn": {
          "value": "1",
          "type": "INT"
        },
        "elysium": {
          "value": "0",
          "type": "INT"
        },
        "purify": {
          "value": "0",
          "type": "INT"
        },
        "availableUnits": {
          "value": "0",
          "type": "INT"
        },
        "modified": {
          "value": "0",
          "type": "INT"
        },
        "lbAttempts": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"}
            ]
          },
          "actions": [
            {
              "type": "SET",
              "var": "availableUnits",
              "value": "0"
            },
            {
              "type": "ADD",
              "var": "availableUnits",
              "value": 1,
              "condition": { "is": "CALL", "value": "@isUnitReady", "args": {"index": "0"} }
            },
            {
              "type": "ADD",
              "var": "availableUnits",
              "value": 1,
              "condition": { "is": "CALL", "value": "@isUnitReady", "args": {"index": "1"} }
            },
            {
              "type": "ADD",
              "var": "availableUnits",
              "value": 1,
              "condition": { "is": "CALL", "value": "@isUnitReady", "args": {"index": "2"} }
            },
            {
              "type": "ADD",
              "var": "availableUnits",
              "value": 1,
              "condition": { "is": "CALL", "value": "@isUnitReady", "args": {"index": "4"} }
            },
            {
              "type": "INFO",
              "value": "Found ${availableUnits} Available Units on Turn ${turn}"
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "3"} },
              { "is": "CALL", "value": "@isUnitLbReady", "args": {"index": "3"} },
              { "not": "CALL", "value": "@isUnitLbSelected", "args": {"index": "3"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka Has Her LB, what sort of world are we living in?  Pressing the button (TM)"
            },
            {
              "type": "CALL",
              "value": "@readyUnitLb",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "200"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "2000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "3"} },
              { "is": "EQUAL", "value": "0", "var":"elysium"},
              { "is": "EQUAL", "value": "4", "var":"availableUnits"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka Used Elysium (Heal + Barrier with 6 Turn Cool down)"
            },
            {
              "type": "SET",
              "var": "elysium",
              "value": "6"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "9",
                "column": "0"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "3"} },
              { "is": "EQUAL", "value": "0", "var":"purify"},
              { "is": "LESS", "value": "4", "var":"availableUnits"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka Used Purify+ (Cure Status + Barrier with 4 Turn Cool down)"
            },
            {
              "type": "SET",
              "var": "purify",
              "value": "4"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "10",
                "column": "0"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "2000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "3"} },
              { "is": "LESS", "value": "4", "var":"availableUnits"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka Used Stop Detach (Cure Stop)"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "6",
                "column": "1"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "2000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "3"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka Used Curaja (Big Heal)"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "4",
                "column": "1"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "WAIT",
              "value": "2000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "0", "var":"segment"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Ayaka might be dead, continue"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "1"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "1", "var":"segment"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Pressing Reload"
            },
            {
              "type": "TAP",
              "value": "battle-reload"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "2"
            },
            {
              "type": "WAIT",
              "value": "2000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition":
          {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "0"} },
              { "is": "CALL", "value": "@isUnitMpReady", "args": {"index": "0"} },
              { "not": "CALL", "value": "@isUnitActionReady", "args": {"index": "0"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Setting Up Adam J"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "0"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "12",
                "column": "0"
              }
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "2"} },
              { "is": "CALL", "value": "@isUnitMpReady", "args": {"index": "2"} },
              { "not": "CALL", "value": "@isUnitActionReady", "args": {"index": "2"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Setting Up Olive"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "2"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "9",
                "column": "0"
              }
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "1"} },
              { "is": "CALL", "value": "@isUnitMpReady", "args": {"index": "1"} },
              { "not": "CALL", "value": "@isUnitActionReady", "args": {"index": "1"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Setting Up Grim Lord Sakura"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "1"
              }
            },
            {
              "type": "SLOW_UP",
              "value": "battle-skill-top-slider",
              "count": "7"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-2"
            },
            {
              "type": "WAIT",
              "value": "200"
            },
            {
              "type": "SLOW_DOWN",
              "value": "battle-skill-top-slider"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-3",
              "count": "1"
            },
            {
              "type": "WAIT",
              "value": "200"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-3",
              "count": "1"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },


        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"},
              { "is": "EQUAL", "value": "1", "var":"turn"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "4"} },
              { "is": "CALL", "value": "@isUnitMpReady", "args": {"index": "4"} },
              { "not": "CALL", "value": "@isUnitActionReady", "args": {"index": "4"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Setting Up TT (Turn 1)"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "4"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "11",
                "column": "0"
              }
            },
            {
              "type": "SLOW_UP",
              "value": "battle-skill-top-slider",
              "count": "1"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-5",
              "count": "4"
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },


        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"},
              { "is": "GREATER", "value": "1", "var":"turn"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "4"} },
              { "is": "CALL", "value": "@isUnitMpReady", "args": {"index": "4"} },
              { "not": "CALL", "value": "@isUnitActionReady", "args": {"index": "4"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Setting Up TT (Turn 2+)"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "4"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "12",
                "column": "0"
              }
            },
            {
              "type": "WAIT",
              "value": "1000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "2", "var":"segment"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Checking For LB's"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "3"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"},
              { "is": "LESS", "value": "8", "var":"lbAttempts"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "0"} },
              { "is": "CALL", "value": "@isUnitLbReady", "args": {"index": "0"} },
              { "not": "CALL", "value": "@isUnitLbSelected", "args": {"index": "0"} }
            ]
          },
          "actions": [
            {
              "type": "CALL",
              "value": "@readyUnitLb",
              "args": {
                "index": "0"
              }
            },
            {
              "type": "ADD",
              "var": "lbAttempts",
              "value": "1"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"},
              { "is": "LESS", "value": "8", "var":"lbAttempts"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "1"} },
              { "is": "CALL", "value": "@isUnitLbReady", "args": {"index": "1"} },
              { "not": "CALL", "value": "@isUnitLbSelected", "args": {"index": "1"} }
            ]
          },
          "actions": [
            {
              "type": "CALL",
              "value": "@readyUnitLb",
              "args": {
                "index": "1"
              }
            },
            {
              "type": "ADD",
              "var": "lbAttempts",
              "value": "1"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"},
              { "is": "LESS", "value": "8", "var":"lbAttempts"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "2"} },
              { "is": "CALL", "value": "@isUnitLbReady", "args": {"index": "2"} },
              { "not": "CALL", "value": "@isUnitLbSelected", "args": {"index": "2"} }
            ]
          },
          "actions": [
            {
              "type": "CALL",
              "value": "@readyUnitLb",
              "args": {
                "index": "2"
              }
            },
            {
              "type": "ADD",
              "var": "lbAttempts",
              "value": "1"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"},
              { "is": "LESS", "value": "8", "var":"lbAttempts"},
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "4"} },
              { "is": "CALL", "value": "@isUnitLbReady", "args": {"index": "4"} },
              { "not": "CALL", "value": "@isUnitLbSelected", "args": {"index": "4"} }
            ]
          },
          "actions": [
            {
              "type": "CALL",
              "value": "@readyUnitLb",
              "args": {
                "index": "4"
              }
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "1"
            },
            {
              "type": "ADD",
              "var": "lbAttempts",
              "value": "1"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"},
              { "is": "EQUAL", "value": "1", "var":"modified"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Units were changed, Tapping in order"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "BATCH",
              "value": "start"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "3"
              }
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "4"
              }
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "1"
              }
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "0"
              }
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "2"
              }
            },
            {
              "type": "BATCH",
              "value": "end"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "4"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "EQUAL", "value": "3", "var":"segment"}
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "No unit changes, Hit Repeat"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "TAP",
              "value": "battle-repeat"
            },
            {
              "type": "SET",
              "var": "segment",
              "value": "4"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },

        {
          "condition": { "is": "EQUAL", "value": "4", "var":"segment"},
          "actions": [
            {
              "type": "SET",
              "var": "segment",
              "value": "0"
            },
            {
              "type": "ADD",
              "var": "turn",
              "value": "1"
            },
            {
              "type": "SET",
              "var": "modified",
              "value": "0"
            },
            {
              "type": "SET",
              "var": "lbAttempts",
              "value": "0"
            },
            {
              "type": "ADD",
              "var": "elysium",
              "value": "-1",
              "condition": {
                "is": "GREATER",
                "var": "elysium",
                "value": "0"
              }
            },

            {
              "type": "ADD",
              "var": "purify",
              "value": "-1",
              "condition": {
                "is": "GREATER",
                "var": "purify",
                "value": "0"
              }
            },

            {
              "type": "WAIT",
              "value": "400"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        }

      ]
    }
  }
}